# üîí Security Notes

## ‚úÖ Security Measures Implemented

### 1. Environment Variables Protection

**Protected Files** (in `.gitignore`):
- `.env` - Main configuration file with secrets
- `docker/.env` - Docker-specific secrets
- `.env.local`, `.env.*.local` - Local overrides
- `.env.backup` - Backup files

**Safe Template Files** (tracked in git):
- `.env.example` - Example configuration with placeholders
- `.env.sample` - Master template with documentation
- `docker/.env.example` - Docker template

### 2. SSL/TLS Certificates

All SSL files are excluded from git:
```
ssl/*.crt
ssl/*.key
ssl/*.pem
ssl/cert.*
ssl/private.*
```

For development, certificates are auto-generated by Docker.  
For production, place your certificates in `ssl/` directory.

### 3. Logs and Temporary Files

Excluded from git:
- `*.log`
- `server.log`
- `logs/` directory
- `.ssh_tunnel.pid`
- `__pycache__/`

### 4. No Hardcoded Secrets

‚úÖ **All secrets use environment variables:**
- API keys loaded from `.env`
- Passwords loaded from `.env`
- No hardcoded credentials in source code

‚ùå **Never do this:**
```python
api_key = "sk-proj-..."  # NEVER hardcode!
password = "MyPassword123"  # NEVER hardcode!
```

‚úÖ **Always do this:**
```python
api_key = os.getenv("OPENAI_API_KEY")  # Read from environment
password = os.getenv("WAZUH_API_PASSWORD")  # Read from environment
```

### 5. Docker Secrets Best Practices

**Development:**
- Use `.env` file for local development
- Docker Compose automatically loads `.env`
- Never commit `.env` to version control

**Production:**
- Use Docker secrets or external secret management
- Use environment-specific `.env` files (not in git)
- Consider using HashiCorp Vault, AWS Secrets Manager, etc.

### 6. Configuration Files

**Tracked in Git:**
- `docker-compose.yml` - Uses environment variable substitution
- `.env.example` - Safe template with placeholders
- Source code - No hardcoded secrets

**NOT Tracked in Git:**
- `.env` - Your actual secrets
- `docker/.env` - Docker secrets
- `logs/` - May contain sensitive data
- `ssl/` - Your certificates

## üõ°Ô∏è Security Checklist Before Pushing

Before you push to GitHub/GitLab:

```bash
# 1. Verify .env is not tracked
git ls-files | grep "^\.env$"
# Should return nothing

# 2. Check for API keys in staged files
git diff --cached | grep -i "sk-proj-"
# Should only show example placeholders

# 3. Check for passwords in staged files
git diff --cached | grep -i "password.*="
# Should only show variable assignments, not actual passwords

# 4. Verify .gitignore is working
git status --ignored | grep .env
# Should show .env as ignored

# 5. Double-check no secrets in code
grep -r "sk-proj-[a-zA-Z0-9]" app/ mcp/ frontend/ --include="*.py" --include="*.js"
# Should return nothing
```

## üìù Setting Up for New Developers

When a new developer clones the repository:

```bash
# 1. Clone the repository
git clone <repository-url>
cd mcp_server_wazuh_2025

# 2. Copy environment template
cp .env.example .env

# 3. Edit with actual credentials
nano .env
# Fill in:
# - OPENAI_API_KEY
# - WAZUH_API_PASSWORD
# - WAZUH_INDEXER_PASSWORD
# etc.

# 4. Deploy
./scripts/docker-deploy.sh
```

## ‚ö†Ô∏è What to Do If Secrets Are Accidentally Committed

If you accidentally commit secrets to git:

### Option 1: Secrets Just Committed (Not Pushed Yet)

```bash
# Remove from last commit
git reset HEAD~1
# OR amend the commit
git commit --amend

# Fix the issue (add to .gitignore, remove secrets)
# Then commit again
```

### Option 2: Secrets Already Pushed to GitHub

**IMPORTANT:** Simply removing the file in a new commit is NOT enough!  
The secrets are still in git history.

1. **Immediately rotate all exposed credentials:**
   - Regenerate OpenAI API key
   - Change Wazuh passwords
   - Update all affected systems

2. **Remove from git history:**
   ```bash
   # Use git-filter-repo (recommended)
   git filter-repo --path .env --invert-paths
   
   # OR use BFG Repo-Cleaner
   bfg --delete-files .env
   ```

3. **Force push (WARNING: Coordinate with team!):**
   ```bash
   git push --force-with-lease origin main
   ```

4. **Notify your team** to re-clone the repository

## üîê Production Security Recommendations

For production deployments:

1. **Use Docker Secrets:**
   ```yaml
   secrets:
     openai_key:
       external: true
   services:
     mcp-server:
       secrets:
         - openai_key
   ```

2. **Use Secret Management Service:**
   - AWS Secrets Manager
   - HashiCorp Vault
   - Azure Key Vault
   - Google Secret Manager

3. **Network Security:**
   - Use TLS/SSL for all connections
   - Implement network policies
   - Use private Docker networks

4. **Access Control:**
   - Principle of least privilege
   - Rotate credentials regularly
   - Use strong, unique passwords
   - Enable MFA where possible

5. **Monitoring:**
   - Log access to secrets
   - Monitor for suspicious activity
   - Set up alerts for unauthorized access

## üìö Additional Resources

- [OWASP Secrets Management Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html)
- [Docker Secrets Documentation](https://docs.docker.com/engine/swarm/secrets/)
- [Git Filter-Repo](https://github.com/newren/git-filter-repo)
- [BFG Repo-Cleaner](https://rtyley.github.io/bfg-repo-cleaner/)

---

**Remember:** Security is not a one-time task, it's an ongoing practice!
